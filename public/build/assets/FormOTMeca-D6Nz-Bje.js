import{E as W}from"./excellPDF-D7XX8oil.js";import"./_commonjsHelpers-Cpj98o6Y.js";const z="modulepreload",V=function(n){return"/build/"+n},q={},J=function(a,e,t){let o=Promise.resolve();if(e&&e.length>0){let r=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=r(e.map(d=>{if(d=V(d),d in q)return;q[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":z,u||(g.as="script"),g.crossOrigin="",g.href=d,m&&g.setAttribute("nonce",m),document.head.appendChild(g),u)return new Promise((L,_)=>{g.addEventListener("load",L),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${d}`)))})}))}function c(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return o.then(r=>{for(const l of r||[])l.status==="rejected"&&c(l.reason);return a().catch(c)})};function G(n){const a=document.getElementById(n);if(!a)return;const e=a.cloneNode(!0);e.querySelectorAll("input").forEach(c=>c.remove());const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.appendChild(e),document.body.appendChild(t);const o=document.createRange();o.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(o);try{document.execCommand("copy")}catch{navigator.clipboard.writeText(t.innerHTML)}window.getSelection().removeAllRanges(),document.body.removeChild(t),window.Swal&&Swal.fire({icon:"success",title:"¡Copiado!",text:"Tabla copiada al portapapeles",timer:1500,showConfirmButton:!1})}async function X(n){const a=document.getElementById(n);if(!a)return;const e=new W.Workbook,t=e.addWorksheet("OT Mecánicos"),c=await fetch("/images/intimark.webp").then(s=>s.blob()).then(s=>new Promise(h=>{const f=new FileReader;f.onloadend=()=>h(f.result.split(",")[1]),f.readAsDataURL(s)})),r=e.addImage({base64:c,extension:"webp"});t.addImage(r,{tl:{col:0,row:0},ext:{width:120,height:60}}),t.mergeCells("C1:H2");const l=t.getCell("C1");l.value="ORDEN DE TRABAJO PARA MECÁNICOS",l.font={size:18,bold:!0,color:{argb:"2563EB"}},l.alignment={vertical:"middle",horizontal:"center"};const d=new Date().toLocaleDateString("es-MX");t.mergeCells("C3:E3");const u=t.getCell("O4");u.value=`FECHA DE DESCARGA: ${d}`,u.font={bold:!0,color:{argb:"FF374151"}},u.alignment={vertical:"middle",horizontal:"left"};let p=5;const g=a.querySelector("thead tr"),L=[];g.querySelectorAll("th").forEach(s=>{s.colSpan===1&&L.push(s.innerText.trim())}),t.insertRow(p,L),t.getRow(p).eachCell(s=>{s.font={bold:!0,color:{argb:"FFFFFFFF"}},s.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2563EB"}},s.alignment={vertical:"middle",horizontal:"center"},s.border={top:{style:"thin",color:{argb:"2563EB"}},left:{style:"thin",color:{argb:"2563EB"}},bottom:{style:"thin",color:{argb:"2563EB"}},right:{style:"thin",color:{argb:"2563EB"}}}});let _=p+1;a.querySelectorAll("tbody tr").forEach(s=>{const h=[];s.querySelectorAll("td").forEach(f=>{h.push(f.innerText.trim())}),t.insertRow(_,h),_++});for(let s=p+1;s<_;s++)t.getRow(s).eachCell(h=>{h.border={top:{style:"thin",color:{argb:"CCCCCC"}},left:{style:"thin",color:{argb:"CCCCCC"}},bottom:{style:"thin",color:{argb:"CCCCCC"}},right:{style:"thin",color:{argb:"CCCCCC"}}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F1F5F9"}},h.alignment={vertical:"middle"}});t.columns.forEach((s,h)=>{let f=10;s.eachCell({includeEmpty:!0},A=>{(A.value?A.value.toString():"").split(`
`).forEach($=>{$.length>f&&(f=$.length)})}),s.width=Math.min(f+2,40)});const U=await e.xlsx.writeBuffer(),H=new Blob([U],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),M=window.URL.createObjectURL(H),v=document.createElement("a");v.href=M,v.download="OT_Mecanicos.xlsx",document.body.appendChild(v),v.click(),setTimeout(()=>{document.body.removeChild(v),window.URL.revokeObjectURL(M)},0)}function K(n){const a=document.getElementById(n);if(!a)return;const e=a.cloneNode(!0);e.querySelectorAll("input").forEach(o=>o.remove());const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.appendChild(e),document.body.appendChild(t),J(()=>import("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"),[]).then(()=>{html2canvas(e).then(o=>{const c=o.toDataURL("image/png"),r=new window.jspdf.jsPDF({orientation:"landscape",unit:"pt",format:"a4"}),m=r.internal.pageSize.getWidth()-40,d=o.height*m/o.width;r.addImage(c,"PNG",20,20,m,d),r.save("OT_Mecanicos.pdf"),document.body.removeChild(t)}).catch(()=>{document.body.removeChild(t)})})}let y=[];const E="ordenTrabajoTable",Q=n=>{localStorage.setItem("ordenTrabajoData",JSON.stringify(n))},Y=()=>{const n=localStorage.getItem("ordenTrabajoData");return n?JSON.parse(n):[]},Z=async()=>{try{const n=await fetch("/form-ot-data");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return y=await n.json(),Q(y),y}catch(n){return console.error("Error fetching data:",n),y=Y(),y}},B=(n,a)=>{const e=new Date(n),o=new Date(a).getTime()-e.getTime();return Math.round(o/6e4)},ee=n=>{if(!n)return null;const a=n.split(":").map(Number);return a.length===2?a[0]*60+a[1]:a.length===1?a[0]:null},D=10;let w=1,T=[];const k=(n,a)=>{const e=Math.ceil(n/D);if(e<=1){document.getElementById("pagination-container").innerHTML="";return}let t=`
    <nav class="flex justify-center mt-4" aria-label="Table navigation">
      <ul class="inline-flex -space-x-px text-sm">
        <li>
          <button class="pagination-btn px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            data-page="${a-1}" ${a===1?"disabled":""}>
            Anterior
          </button>
        </li>
    `;for(let o=1;o<=e;o++)t+=`
        <li>
          <button class="pagination-btn px-3 py-2 leading-tight border border-gray-300 ${o===a?"bg-blue-700 text-white dark:bg-blue-600":"bg-white text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"}"
            data-page="${o}">
            ${o}
          </button>
        </li>
        `;t+=`
        <li>
          <button class="pagination-btn px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            data-page="${a+1}" ${a===e?"disabled":""}>
            Siguiente
          </button>
        </li>
      </ul>
    </nav>
    `,document.getElementById("pagination-container").innerHTML=t,document.querySelectorAll(".pagination-btn").forEach(o=>{o.addEventListener("click",c=>{const r=parseInt(o.getAttribute("data-page"));!isNaN(r)&&r>=1&&r<=e&&r!==a&&te(r)})})},te=n=>{w=n,S(T),k(T.length,w)},R=document.getElementById("copy-table-btn"),F=document.getElementById("save-table-btn"),b=document.getElementById("save-modal"),N=document.getElementById("close-modal-btn"),O=document.getElementById("download-excel-btn"),P=document.getElementById("download-pdf-btn");R&&R.addEventListener("click",()=>G(E));F&&F.addEventListener("click",()=>{b&&b.classList.remove("hidden")});N&&N.addEventListener("click",()=>{b&&b.classList.add("hidden")});O&&O.addEventListener("click",()=>{X(E),b&&b.classList.add("hidden")});P&&P.addEventListener("click",()=>{K(E),b&&b.classList.add("hidden")});let i={folio:"",modulo:"",supervisor:"",op:"",nombre:"",problema:"",hora_paro:"",hora_termino:"",total_min:"",id_maquina:"",tipo_maquina:"",mecanico:"",codigo_falla:"",causa:"",accion:""},x=null,C="asc";const j=(n,a)=>{const e=n.follow_atention||{};switch(a){case"folio":return e.Folio??"";case"modulo":return e.Modulo??"";case"supervisor":return e.Supervisor??"";case"op":return e.Operario??"";case"nombre":return e.NombreOperario??"";case"problema":return e.Problema??"";case"hora_paro":return e.created_at??"";case"hora_termino":return e.updated_at??"";case"total_min":return e.created_at&&e.updated_at?B(e.created_at,e.updated_at):"";case"id_maquina":return e.NumMach??"";case"tipo_maquina":return e.Maquina??"";case"mecanico":return e.Mecanico??"";case"codigo_falla":return e.Falla??"";case"causa":return e.Causa??"";case"accion":return e.Accion??"";default:return""}},I=()=>{let n=y.filter(a=>{const e=a.follow_atention||{};return(!i.folio||(e.Folio??"").toString().toLowerCase().includes(i.folio.toLowerCase()))&&(!i.modulo||(e.Modulo??"").toLowerCase().includes(i.modulo.toLowerCase()))&&(!i.supervisor||(e.Supervisor??"").toLowerCase().includes(i.supervisor.toLowerCase()))&&(!i.op||(e.Operario??"").toLowerCase().includes(i.op.toLowerCase()))&&(!i.nombre||(e.NombreOperario??"").toLowerCase().includes(i.nombre.toLowerCase()))&&(!i.problema||(e.Problema??"").toLowerCase().includes(i.problema.toLowerCase()))&&(!i.hora_paro||(e.created_at??"").toLowerCase().includes(i.hora_paro.toLowerCase()))&&(!i.hora_termino||(e.updated_at??"").toLowerCase().includes(i.hora_termino.toLowerCase()))&&(!i.total_min||e.created_at&&e.updated_at&&B(e.created_at,e.updated_at).toString().includes(i.total_min))&&(!i.id_maquina||(e.NumMach??"").toLowerCase().includes(i.id_maquina.toLowerCase()))&&(!i.tipo_maquina||(e.Maquina??"").toLowerCase().includes(i.tipo_maquina.toLowerCase()))&&(!i.mecanico||(e.Mecanico??"").toLowerCase().includes(i.mecanico.toLowerCase()))&&(!i.codigo_falla||(e.Falla??"").toLowerCase().includes(i.codigo_falla.toLowerCase()))&&(!i.causa||(e.Causa??"").toLowerCase().includes(i.causa.toLowerCase()))&&(!i.accion||(e.Accion??"").toLowerCase().includes(i.accion.toLowerCase()))});return x&&n.sort((a,e)=>{let t=j(a,x),o=j(e,x);return(x==="hora_paro"||x==="hora_termino")&&(t=t?new Date(t):new Date(0),o=o?new Date(o):new Date(0)),typeof t=="number"&&typeof o=="number"?C==="asc"?t-o:o-t:!isNaN(t)&&!isNaN(o)?(t=Number(t),o=Number(o),C==="asc"?t-o:o-t):(t=(t??"").toString().toLowerCase(),o=(o??"").toString().toLowerCase(),t<o?C==="asc"?-1:1:t>o?C==="asc"?1:-1:0)}),n},S=n=>{T=n;const e=document.getElementById(E).querySelector("tbody");e.innerHTML="";const t=(w-1)*D,o=t+D;n.slice(t,o).forEach((r,l)=>{const m=document.createElement("tr");m.className="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors";let d="",u="text-purple-700 dark:text-purple-400",p=null;r.follow_atention&&r.follow_atention.created_at&&r.follow_atention.updated_at&&(d=B(r.follow_atention.created_at,r.follow_atention.updated_at),p=ee(r.follow_atention.TimeEstimado),p!==null&&d!==""&&(d>p?u="text-red-700 dark:text-red-400 font-bold":u="text-green-700 dark:text-green-400 font-bold")),m.innerHTML=`
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${r.follow_atention.Folio??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${r.follow_atention.Modulo??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Supervisor??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Operario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.NombreOperario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Problema??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-blue-700 dark:text-blue-400">${r.follow_atention.created_at?new Date(r.follow_atention.created_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-green-700 dark:text-green-400">${r.follow_atention.updated_at?new Date(r.follow_atention.updated_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm ${u}">${d!==""?d+" min":""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.NumMach??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Maquina??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Mecanico??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-red-700 dark:text-red-400">${r.follow_atention.Falla??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-yellow-700 dark:text-yellow-400">${r.follow_atention.Causa??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${r.follow_atention.Accion??""}</td>
        `,e.appendChild(m)})},oe=["folio","modulo","supervisor","op","nombre","problema","hora_paro","hora_termino","total_min","id_maquina","tipo_maquina","mecanico","codigo_falla","causa","accion"];oe.forEach(n=>{const a=document.getElementById(n);a&&a.addEventListener("input",()=>{i[n]=a.value,w=1;const e=I();S(e),k(e.length,w)})});const ae=[{id:"folio",idx:0},{id:"modulo",idx:1},{id:"supervisor",idx:2},{id:"op",idx:3},{id:"nombre",idx:4},{id:"problema",idx:5},{id:"hora_paro",idx:6},{id:"hora_termino",idx:7},{id:"total_min",idx:8},{id:"id_maquina",idx:9},{id:"tipo_maquina",idx:10},{id:"mecanico",idx:11},{id:"codigo_falla",idx:12},{id:"causa",idx:13},{id:"accion",idx:14}],re=()=>{const n=document.getElementById(E);if(!n)return;const a=n.querySelectorAll("thead tr:first-child th");ae.forEach((e,t)=>{const o=a[e.idx];o&&(o.classList.add("cursor-pointer","select-none"),o.addEventListener("click",()=>{x===e.id?C=C==="asc"?"desc":"asc":(x=e.id,C="asc"),w=1;const c=I();S(c),k(c.length,w),a.forEach((r,l)=>{r.classList.remove("text-blue-700","dark:text-blue-400"),l===e.idx&&r.classList.add("text-blue-700","dark:text-blue-400")})}))})},ne=async()=>{y=await Z(),w=1;const a=I();if(S(a),!document.getElementById("pagination-container")){const e=document.createElement("div");e.id="pagination-container",e.className="mt-4 flex justify-center",table.parentNode.appendChild(e)}k(a.length,w),re()};document.addEventListener("DOMContentLoaded",ne);
