import{E as P}from"./excellPDF-D7XX8oil.js";import"./_commonjsHelpers-Cpj98o6Y.js";const N="modulepreload",j=function(e){return"/build/"+e},L={},q=function(o,r,a){let n=Promise.resolve();if(r&&r.length>0){let t=function(l){return Promise.all(l.map(s=>Promise.resolve(s).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),p=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));n=t(r.map(l=>{if(l=j(l),l in L)return;L[l]=!0;const s=l.endsWith(".css"),c=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const u=document.createElement("link");if(u.rel=s?"stylesheet":N,s||(u.as="script"),u.crossOrigin="",u.href=l,p&&u.setAttribute("nonce",p),document.head.appendChild(u),s)return new Promise((E,f)=>{u.addEventListener("load",E),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function g(t){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=t,window.dispatchEvent(i),!i.defaultPrevented)throw t}return n.then(t=>{for(const i of t||[])i.status==="rejected"&&g(i.reason);return o().catch(g)})};function U(e){const o=document.getElementById(e);if(!o)return;const r=o.cloneNode(!0);r.querySelectorAll("input").forEach(g=>g.remove());const a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.appendChild(r),document.body.appendChild(a);const n=document.createRange();n.selectNode(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(n);try{document.execCommand("copy")}catch{navigator.clipboard.writeText(a.innerHTML)}window.getSelection().removeAllRanges(),document.body.removeChild(a),window.Swal&&Swal.fire({icon:"success",title:"¡Copiado!",text:"Tabla copiada al portapapeles",timer:1500,showConfirmButton:!1})}async function H(e){const o=document.getElementById(e);if(!o)return;const r=new P.Workbook,a=r.addWorksheet("OT Mecánicos"),g=await fetch("/images/intimark.webp").then(d=>d.blob()).then(d=>new Promise(h=>{const m=new FileReader;m.onloadend=()=>h(m.result.split(",")[1]),m.readAsDataURL(d)})),t=r.addImage({base64:g,extension:"webp"});a.addImage(t,{tl:{col:0,row:0},ext:{width:120,height:60}}),a.mergeCells("C1:H2");const i=a.getCell("C1");i.value="ORDEN DE TRABAJO PARA MECÁNICOS",i.font={size:18,bold:!0,color:{argb:"2563EB"}},i.alignment={vertical:"middle",horizontal:"center"};const l=new Date().toLocaleDateString("es-MX");a.mergeCells("C3:E3");const s=a.getCell("O4");s.value=`FECHA DE DESCARGA: ${l}`,s.font={bold:!0,color:{argb:"FF374151"}},s.alignment={vertical:"middle",horizontal:"left"};let c=5;const u=o.querySelector("thead tr"),E=[];u.querySelectorAll("th").forEach(d=>{d.colSpan===1&&E.push(d.innerText.trim())}),a.insertRow(c,E),a.getRow(c).eachCell(d=>{d.font={bold:!0,color:{argb:"FFFFFFFF"}},d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2563EB"}},d.alignment={vertical:"middle",horizontal:"center"},d.border={top:{style:"thin",color:{argb:"2563EB"}},left:{style:"thin",color:{argb:"2563EB"}},bottom:{style:"thin",color:{argb:"2563EB"}},right:{style:"thin",color:{argb:"2563EB"}}}});let f=c+1;o.querySelectorAll("tbody tr").forEach(d=>{const h=[];d.querySelectorAll("td").forEach(m=>{h.push(m.innerText.trim())}),a.insertRow(f,h),f++});for(let d=c+1;d<f;d++)a.getRow(d).eachCell(h=>{h.border={top:{style:"thin",color:{argb:"CCCCCC"}},left:{style:"thin",color:{argb:"CCCCCC"}},bottom:{style:"thin",color:{argb:"CCCCCC"}},right:{style:"thin",color:{argb:"CCCCCC"}}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F1F5F9"}},h.alignment={vertical:"middle"}});a.columns.forEach((d,h)=>{let m=10;d.eachCell({includeEmpty:!0},S=>{(S.value?S.value.toString():"").split(`
`).forEach(T=>{T.length>m&&(m=T.length)})}),d.width=Math.min(m+2,40)});const F=await r.xlsx.writeBuffer(),O=new Blob([F],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=window.URL.createObjectURL(O),w=document.createElement("a");w.href=_,w.download="OT_Mecanicos.xlsx",document.body.appendChild(w),w.click(),setTimeout(()=>{document.body.removeChild(w),window.URL.revokeObjectURL(_)},0)}function W(e){const o=document.getElementById(e);if(!o)return;const r=o.cloneNode(!0);r.querySelectorAll("input").forEach(n=>n.remove());const a=document.createElement("div");a.style.position="absolute",a.style.left="-9999px",a.appendChild(r),document.body.appendChild(a),q(()=>import("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"),[]).then(()=>{html2canvas(r).then(n=>{const g=n.toDataURL("image/png"),t=new window.jspdf.jsPDF({orientation:"landscape",unit:"pt",format:"a4"}),p=t.internal.pageSize.getWidth()-40,l=n.height*p/n.width;t.addImage(g,"PNG",20,20,p,l),t.save("OT_Mecanicos.pdf"),document.body.removeChild(a)}).catch(()=>{document.body.removeChild(a)})})}let b=[];const v="ordenTrabajoTable",z=e=>{localStorage.setItem("ordenTrabajoData",JSON.stringify(e))},J=()=>{const e=localStorage.getItem("ordenTrabajoData");return e?JSON.parse(e):[]},G=async()=>{try{const e=await fetch("/form-ot-data");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return b=await e.json(),z(b),b}catch(e){return console.error("Error fetching data:",e),b=J(),b}},V=(e,o)=>{const r=new Date(e),n=new Date(o).getTime()-r.getTime();return Math.round(n/6e4)},X=e=>{if(!e)return null;const o=e.split(":").map(Number);return o.length===2?o[0]*60+o[1]:o.length===1?o[0]:null},C=10;let x=1,k=[];const R=(e,o)=>{const r=Math.ceil(e/C);if(r<=1){document.getElementById("pagination-container").innerHTML="";return}let a=`
    <nav class="flex justify-center mt-4" aria-label="Table navigation">
      <ul class="inline-flex -space-x-px text-sm">
        <li>
          <button class="pagination-btn px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            data-page="${o-1}" ${o===1?"disabled":""}>
            Anterior
          </button>
        </li>
    `;for(let n=1;n<=r;n++)a+=`
        <li>
          <button class="pagination-btn px-3 py-2 leading-tight border border-gray-300 ${n===o?"bg-blue-700 text-white dark:bg-blue-600":"bg-white text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"}"
            data-page="${n}">
            ${n}
          </button>
        </li>
        `;a+=`
        <li>
          <button class="pagination-btn px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            data-page="${o+1}" ${o===r?"disabled":""}>
            Siguiente
          </button>
        </li>
      </ul>
    </nav>
    `,document.getElementById("pagination-container").innerHTML=a,document.querySelectorAll(".pagination-btn").forEach(n=>{n.addEventListener("click",g=>{const t=parseInt(n.getAttribute("data-page"));!isNaN(t)&&t>=1&&t<=r&&t!==o&&K(t)})})},K=e=>{x=e,M(k),R(k.length,x)},M=e=>{k=e;const r=document.getElementById(v).querySelector("tbody");r.innerHTML="";const a=(x-1)*C,n=a+C;e.slice(a,n).forEach((t,i)=>{const p=document.createElement("tr");p.className="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors";let l="",s="text-purple-700 dark:text-purple-400",c=null;t.follow_atention&&t.follow_atention.created_at&&t.follow_atention.updated_at&&(l=V(t.follow_atention.created_at,t.follow_atention.updated_at),c=X(t.follow_atention.TimeEstimado),c!==null&&l!==""&&(l>c?s="text-red-700 dark:text-red-400 font-bold":s="text-green-700 dark:text-green-400 font-bold")),p.innerHTML=`
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${t.follow_atention.Folio??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${t.follow_atention.Modulo??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Supervisor??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Operario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.NombreOperario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Problema??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-blue-700 dark:text-blue-400">${t.follow_atention.created_at?new Date(t.follow_atention.created_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-green-700 dark:text-green-400">${t.follow_atention.updated_at?new Date(t.follow_atention.updated_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm ${s}">${l!==""?l+" min":""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.NumMach??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Maquina??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Mecanico??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-red-700 dark:text-red-400">${t.follow_atention.Falla??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-yellow-700 dark:text-yellow-400">${t.follow_atention.Causa??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Accion??""}</td>
        `,r.appendChild(p)})},D=document.getElementById("copy-table-btn"),B=document.getElementById("save-table-btn"),y=document.getElementById("save-modal"),I=document.getElementById("close-modal-btn"),$=document.getElementById("download-excel-btn"),A=document.getElementById("download-pdf-btn");D&&D.addEventListener("click",()=>U(v));B&&B.addEventListener("click",()=>{y&&y.classList.remove("hidden")});I&&I.addEventListener("click",()=>{y&&y.classList.add("hidden")});$&&$.addEventListener("click",()=>{H(v),y&&y.classList.add("hidden")});A&&A.addEventListener("click",()=>{W(v),y&&y.classList.add("hidden")});const Q=async()=>{let e=await G();if(x=1,M(e),!document.getElementById("pagination-container")){const o=document.createElement("div");o.id="pagination-container",o.className="mt-4 flex justify-center",table.parentNode.appendChild(o)}R(e.length,x)};document.addEventListener("DOMContentLoaded",Q);
