var S=function(){function n(){this._instances={Accordion:{},Carousel:{},Collapse:{},Dial:{},Dismiss:{},Drawer:{},Dropdown:{},Modal:{},Popover:{},Tabs:{},Tooltip:{},InputCounter:{},CopyClipboard:{},Datepicker:{}}}return n.prototype.addInstance=function(t,e,s,i){if(i===void 0&&(i=!1),!this._instances[t])return console.warn("Flowbite: Component ".concat(t," does not exist.")),!1;if(this._instances[t][s]&&!i){console.warn("Flowbite: Instance with ID ".concat(s," already exists."));return}i&&this._instances[t][s]&&this._instances[t][s].destroyAndRemoveInstance(),this._instances[t][s||this._generateRandomId()]=e},n.prototype.getAllInstances=function(){return this._instances},n.prototype.getInstances=function(t){return this._instances[t]?this._instances[t]:(console.warn("Flowbite: Component ".concat(t," does not exist.")),!1)},n.prototype.getInstance=function(t,e){if(this._componentAndInstanceCheck(t,e)){if(!this._instances[t][e]){console.warn("Flowbite: Instance with ID ".concat(e," does not exist."));return}return this._instances[t][e]}},n.prototype.destroyAndRemoveInstance=function(t,e){this._componentAndInstanceCheck(t,e)&&(this.destroyInstanceObject(t,e),this.removeInstance(t,e))},n.prototype.removeInstance=function(t,e){this._componentAndInstanceCheck(t,e)&&delete this._instances[t][e]},n.prototype.destroyInstanceObject=function(t,e){this._componentAndInstanceCheck(t,e)&&this._instances[t][e].destroy()},n.prototype.instanceExists=function(t,e){return!(!this._instances[t]||!this._instances[t][e])},n.prototype._generateRandomId=function(){return Math.random().toString(36).substr(2,9)},n.prototype._componentAndInstanceCheck=function(t,e){return this._instances[t]?this._instances[t][e]?!0:(console.warn("Flowbite: Instance with ID ".concat(e," does not exist.")),!1):(console.warn("Flowbite: Component ".concat(t," does not exist.")),!1)},n}(),k=new S;typeof window<"u"&&(window.FlowbiteInstances=k);var h=function(){return h=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},h.apply(this,arguments)},y={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},z={id:null,override:!0},C=function(){function n(t,e,s,i){t===void 0&&(t=null),e===void 0&&(e=[]),s===void 0&&(s=y),i===void 0&&(i=z),this._instanceId=i.id?i.id:t.id,this._carouselEl=t,this._items=e,this._options=h(h(h({},y),s),{indicators:h(h({},y.indicators),s.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._intervalDuration=this._options.interval,this._intervalInstance=null,this._initialized=!1,this.init(),k.addInstance("Carousel",this,this._instanceId,i.override)}return n.prototype.init=function(){var t=this;this._items.length&&!this._initialized&&(this._items.map(function(e){e.el.classList.add("absolute","inset-0","transition-transform","transform")}),this.getActiveItem()?this.slideTo(this.getActiveItem().position):this.slideTo(0),this._indicators.map(function(e,s){e.el.addEventListener("click",function(){t.slideTo(s)})}),this._initialized=!0)},n.prototype.destroy=function(){this._initialized&&(this._initialized=!1)},n.prototype.removeInstance=function(){k.removeInstance("Carousel",this._instanceId)},n.prototype.destroyAndRemoveInstance=function(){this.destroy(),this.removeInstance()},n.prototype.getItem=function(t){return this._items[t]},n.prototype.slideTo=function(t){var e=this._items[t],s={left:e.position===0?this._items[this._items.length-1]:this._items[e.position-1],middle:e,right:e.position===this._items.length-1?this._items[0]:this._items[e.position+1]};this._rotate(s),this._setActiveItem(e),this._intervalInstance&&(this.pause(),this.cycle()),this._options.onChange(this)},n.prototype.next=function(){var t=this.getActiveItem(),e=null;t.position===this._items.length-1?e=this._items[0]:e=this._items[t.position+1],this.slideTo(e.position),this._options.onNext(this)},n.prototype.prev=function(){var t=this.getActiveItem(),e=null;t.position===0?e=this._items[this._items.length-1]:e=this._items[t.position-1],this.slideTo(e.position),this._options.onPrev(this)},n.prototype._rotate=function(t){if(this._items.map(function(e){e.el.classList.add("hidden")}),this._items.length===1){t.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),t.middle.el.classList.add("translate-x-0","z-20");return}t.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),t.left.el.classList.add("-translate-x-full","z-10"),t.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),t.middle.el.classList.add("translate-x-0","z-30"),t.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-30"),t.right.el.classList.add("translate-x-full","z-20")},n.prototype.cycle=function(){var t=this;typeof window<"u"&&(this._intervalInstance=window.setInterval(function(){t.next()},this._intervalDuration))},n.prototype.pause=function(){clearInterval(this._intervalInstance)},n.prototype.getActiveItem=function(){return this._activeItem},n.prototype._setActiveItem=function(t){var e,s,i=this;this._activeItem=t;var l=t.position;this._indicators.length&&(this._indicators.map(function(r){var c,o;r.el.setAttribute("aria-current","false"),(c=r.el.classList).remove.apply(c,i._options.indicators.activeClasses.split(" ")),(o=r.el.classList).add.apply(o,i._options.indicators.inactiveClasses.split(" "))}),(e=this._indicators[l].el.classList).add.apply(e,this._options.indicators.activeClasses.split(" ")),(s=this._indicators[l].el.classList).remove.apply(s,this._options.indicators.inactiveClasses.split(" ")),this._indicators[l].el.setAttribute("aria-current","true"))},n.prototype.updateOnNext=function(t){this._options.onNext=t},n.prototype.updateOnPrev=function(t){this._options.onPrev=t},n.prototype.updateOnChange=function(t){this._options.onChange=t},n}();function D(){document.querySelectorAll("[data-carousel]").forEach(function(n){var t=n.getAttribute("data-carousel-interval"),e=n.getAttribute("data-carousel")==="slide",s=[],i=0;n.querySelectorAll("[data-carousel-item]").length&&Array.from(n.querySelectorAll("[data-carousel-item]")).map(function(u,a){s.push({position:a,el:u}),u.getAttribute("data-carousel-item")==="active"&&(i=a)});var l=[];n.querySelectorAll("[data-carousel-slide-to]").length&&Array.from(n.querySelectorAll("[data-carousel-slide-to]")).map(function(u){l.push({position:parseInt(u.getAttribute("data-carousel-slide-to")),el:u})});var r=new C(n,s,{defaultPosition:i,indicators:{items:l},interval:t||y.interval});e&&r.cycle();var c=n.querySelector("[data-carousel-next]"),o=n.querySelector("[data-carousel-prev]");c&&c.addEventListener("click",function(){r.next()}),o&&o.addEventListener("click",function(){r.prev()})})}typeof window<"u"&&(window.Carousel=C,window.initCarousels=D);const T="dashboard_tops_data_v1",M=5*60*1e3;let d=null;function q(n,t){try{localStorage.setItem(n,JSON.stringify({data:t,ts:Date.now()}))}catch{}}function B(n,t){try{const e=JSON.parse(localStorage.getItem(n));return!e||!e.ts||!e.data||Date.now()-e.ts>t?null:e.data}catch{return null}}function w(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function I(n,t,e,s="bg-white dark:bg-gray-800"){return`
        <div class="flex flex-col items-center justify-center rounded-xl shadow-md border border-gray-200 dark:border-gray-700 ${s} p-2 w-full max-w-none h-full min-h-[120px]">
            <div class="flex items-center justify-center mb-1">
                <span class="inline-block">${e}</span>
            </div>
            <h2 class="text-base font-bold text-gray-800 dark:text-gray-100 mb-1 text-center">${w(n)}</h2>
            <div class="w-full grid grid-cols-3 gap-2">
                ${t.map(i=>`
                    <div class="flex flex-col items-center justify-center bg-transparent rounded hover:bg-emerald-50 dark:hover:bg-gray-700 transition text-sm py-1">
                        <span class="text-gray-700 dark:text-gray-200 truncate text-center">${w(i.label)} </br> ${w(i.total)} </br></span>
                    </div>
                `).join("")}
            </div>
        </div>
    `}document.addEventListener("DOMContentLoaded",async()=>{const n=document.getElementById("dashboard-topsmeca");if(!n)return;if(n.innerHTML='<div class="flex justify-center items-center min-h-[120px] text-gray-400">Cargando...</div>',d=B(T,M),!d)try{d=await(await fetch("/dashboard/tops",{credentials:"same-origin"})).json(),q(T,d)}catch{n.innerHTML='<div class="text-red-500 p-4">No se pudo cargar el top.</div>';return}const t=`
        <svg class="w-10 h-10 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" fill="currentColor" class="text-blue-100"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06A1.65 1.65 0 0 0 15 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 8.6 15a1.65 1.65 0 0 0-1.82-.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 15 8.6a1.65 1.65 0 0 0 1.82.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 15z"/>
        </svg>
    `,e=(d.maquinas||[]).map(a=>({label:a.Maquina,total:a.total})),s='<svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor" class="text-red-100"/><path d="M12 8v4m0 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',i=(d.problemas||[]).map(a=>({label:a.problema||a.Problema,total:a.total})),l='<svg class="w-10 h-10 text-emerald-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="3" fill="currentColor" class="text-emerald-100"/><path d="M4 9h16M9 4v16" stroke="currentColor" stroke-width="2"/></svg>',r=(d.modulos||[]).map(a=>({label:a.Modulo,total:a.total})),c=[{html:I("Top 3 Máquinas con más problemas",e,t,"bg-blue-50 dark:bg-blue-900")},{html:I("Top 3 Problemas más recurrentes",i,s,"bg-red-50 dark:bg-red-900")},{html:I("Top 3 Módulos con más tickets",r,l,"bg-emerald-50 dark:bg-emerald-900")}],o="tops-carousel",u="tops-carousel-item-";n.innerHTML=`
        <div id="${o}" class="relative w-full" data-carousel="slide">
            <div class="relative h-[120px] overflow-hidden rounded-lg w-full">
                ${c.map((a,p)=>`
                    <div id="${u}${p}" class="hidden duration-700 ease-in-out w-full h-[120px]" data-carousel-item${p===0?'="active"':""}>
                        <div class="flex justify-center items-center h-full w-full">${a.html}</div>
                    </div>
                `).join("")}
            </div>
            <button type="button" id="carousel-prev-btn" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-2 cursor-pointer group focus:outline-none" data-carousel-prev>
                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                    <svg class="w-3 h-3 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                    </svg>
                    <span class="sr-only">Previous</span>
                </span>
            </button>
            <button type="button" id="carousel-next-btn" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-2 cursor-pointer group focus:outline-none" data-carousel-next>
                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-white/30 dark:bg-gray-800/30 group-hover:bg-white/50 dark:group-hover:bg-gray-800/60 group-focus:ring-2 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
                    <svg class="w-3 h-3 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                    </svg>
                    <span class="sr-only">Next</span>
                </span>
            </button>
            <button type="button" id="carousel-pause-btn" class="absolute top-1 right-1/2 translate-x-1/2 z-40 flex items-center justify-center px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded-full shadow text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition text-xs">
                <span id="carousel-pause-icon" class="material-symbols-outlined">pause</span>
            </button>
        </div>
    `,setTimeout(()=>{const a=document.getElementById(o),p=c.map((g,L)=>({position:L,el:document.getElementById(`${u}${L}`)})),_={defaultPosition:0,interval:1e4,onNext:()=>{},onPrev:()=>{},onChange:()=>{}},j={id:o,override:!0},m=new C(a,p,_,j);let f=!1;const P=document.getElementById("carousel-pause-btn"),A=document.getElementById("carousel-pause-icon");let v=setInterval(()=>m.next(),_.interval);function x(){v||(v=setInterval(()=>m.next(),_.interval))}function b(){v&&(clearInterval(v),v=null)}P.addEventListener("click",g=>{g.preventDefault(),f?(x(),A.textContent="pause"):(b(),A.textContent="play_arrow"),f=!f}),document.getElementById("carousel-prev-btn").addEventListener("click",()=>{m.prev(),f||(b(),x())}),document.getElementById("carousel-next-btn").addEventListener("click",()=>{m.next(),f||(b(),x())}),p.forEach(g=>{g.el.addEventListener("transitionend",()=>{g.el.offsetWidth})})},0)});
