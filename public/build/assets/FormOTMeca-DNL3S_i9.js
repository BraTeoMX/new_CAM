import{E as I}from"./excellPDF-D7XX8oil.js";import"./_commonjsHelpers-Cpj98o6Y.js";const $="modulepreload",F=function(e){return"/build/"+e},_={},M=function(a,r,t){let d=Promise.resolve();if(r&&r.length>0){let l=function(s){return Promise.all(s.map(p=>Promise.resolve(p).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));d=l(r.map(s=>{if(s=F(s),s in _)return;_[s]=!0;const p=s.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${u}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":$,p||(m.as="script"),m.crossOrigin="",m.href=s,i&&m.setAttribute("nonce",i),document.head.appendChild(m),p)return new Promise((x,h)=>{m.addEventListener("load",x),m.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})}))}function c(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return d.then(l=>{for(const o of l||[])o.status==="rejected"&&c(o.reason);return a().catch(c)})};function O(e){const a=document.getElementById(e);if(!a)return;const r=a.cloneNode(!0);r.querySelectorAll("input").forEach(c=>c.remove());const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.appendChild(r),document.body.appendChild(t);const d=document.createRange();d.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(d);try{document.execCommand("copy")}catch{navigator.clipboard.writeText(t.innerHTML)}window.getSelection().removeAllRanges(),document.body.removeChild(t),window.Swal&&Swal.fire({icon:"success",title:"¡Copiado!",text:"Tabla copiada al portapapeles",timer:1500,showConfirmButton:!1})}async function P(e){const a=document.getElementById(e);if(!a)return;const r=new I.Workbook,t=r.addWorksheet("OT Mecánicos"),c=await fetch("/images/intimark.webp").then(n=>n.blob()).then(n=>new Promise(f=>{const w=new FileReader;w.onloadend=()=>f(w.result.split(",")[1]),w.readAsDataURL(n)})),l=r.addImage({base64:c,extension:"webp"});t.addImage(l,{tl:{col:0,row:0},ext:{width:120,height:60}}),t.mergeCells("C1:H2");const o=t.getCell("C1");o.value="ORDEN DE TRABAJO PARA MECÁNICOS",o.font={size:18,bold:!0,color:{argb:"2563EB"}},o.alignment={vertical:"middle",horizontal:"center"};const s=new Date().toLocaleDateString("es-MX");t.mergeCells("C3:E3");const p=t.getCell("O4");p.value=`FECHA DE DESCARGA: ${s}`,p.font={bold:!0,color:{argb:"FF374151"}},p.alignment={vertical:"middle",horizontal:"left"};let u=5;const m=a.querySelector("thead tr"),x=[];m.querySelectorAll("th").forEach(n=>{n.colSpan===1&&x.push(n.innerText.trim())}),t.insertRow(u,x),t.getRow(u).eachCell(n=>{n.font={bold:!0,color:{argb:"FFFFFFFF"}},n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"2563EB"}},n.alignment={vertical:"middle",horizontal:"center"},n.border={top:{style:"thin",color:{argb:"2563EB"}},left:{style:"thin",color:{argb:"2563EB"}},bottom:{style:"thin",color:{argb:"2563EB"}},right:{style:"thin",color:{argb:"2563EB"}}}});let h=u+1;a.querySelectorAll("tbody tr").forEach(n=>{const f=[];n.querySelectorAll("td").forEach(w=>{f.push(w.innerText.trim())}),t.insertRow(h,f),h++});for(let n=u+1;n<h;n++)t.getRow(n).eachCell(f=>{f.border={top:{style:"thin",color:{argb:"CCCCCC"}},left:{style:"thin",color:{argb:"CCCCCC"}},bottom:{style:"thin",color:{argb:"CCCCCC"}},right:{style:"thin",color:{argb:"CCCCCC"}}},f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"F1F5F9"}},f.alignment={vertical:"middle"}});t.columns.forEach((n,f)=>{let w=10;n.eachCell({includeEmpty:!0},v=>{(v.value?v.value.toString():"").split(`
`).forEach(k=>{k.length>w&&(w=k.length)})}),n.width=Math.min(w+2,40)});const R=await r.xlsx.writeBuffer(),A=new Blob([R],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),E=window.URL.createObjectURL(A),y=document.createElement("a");y.href=E,y.download="OT_Mecanicos.xlsx",document.body.appendChild(y),y.click(),setTimeout(()=>{document.body.removeChild(y),window.URL.revokeObjectURL(E)},0)}function N(e){const a=document.getElementById(e);if(!a)return;const r=a.cloneNode(!0);r.querySelectorAll("input").forEach(d=>d.remove());const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.appendChild(r),document.body.appendChild(t),M(()=>import("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"),[]).then(()=>{html2canvas(r).then(d=>{const c=d.toDataURL("image/png"),l=new window.jspdf.jsPDF({orientation:"landscape",unit:"pt",format:"a4"}),i=l.internal.pageSize.getWidth()-40,s=d.height*i/d.width;l.addImage(c,"PNG",20,20,i,s),l.save("OT_Mecanicos.pdf"),document.body.removeChild(t)}).catch(()=>{document.body.removeChild(t)})})}let b=[];const C="ordenTrabajoTable",U=e=>{localStorage.setItem("ordenTrabajoData",JSON.stringify(e))},j=()=>{const e=localStorage.getItem("ordenTrabajoData");return e?JSON.parse(e):[]},q=async()=>{try{const e=await fetch("/form-ot-data");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return b=await e.json(),U(b),b}catch(e){return console.error("Error fetching data:",e),b=j(),b}},H=(e,a)=>{const r=new Date(e),d=new Date(a).getTime()-r.getTime();return Math.round(d/6e4)},W=e=>{if(!e)return null;const a=e.split(":").map(Number);return a.length===2?a[0]*60+a[1]:a.length===1?a[0]:null},z=e=>{const r=document.getElementById(C).querySelector("tbody");r.innerHTML="",e.forEach((t,d)=>{const c=document.createElement("tr");c.className="bg-white border-b dark:bg-gray-900 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors";let l="",o="text-purple-700 dark:text-purple-400",i=null;t.follow_atention&&t.follow_atention.created_at&&t.follow_atention.updated_at&&(l=H(t.follow_atention.created_at,t.follow_atention.updated_at),i=W(t.follow_atention.TimeEstimado),i!==null&&l!==""&&(l>i?o="text-red-700 dark:text-red-400 font-bold":o="text-green-700 dark:text-green-400 font-bold")),c.innerHTML=`
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${t.follow_atention.Folio??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${t.follow_atention.Modulo??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Supervisor??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Operario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.NombreOperario??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Problema??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-blue-700 dark:text-blue-400">${t.follow_atention.created_at?new Date(t.follow_atention.created_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-green-700 dark:text-green-400">${t.follow_atention.updated_at?new Date(t.follow_atention.updated_at).toLocaleString():""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm ${o}">${l!==""?l+" min":""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.NumMach??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Maquina??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Mecanico??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-red-700 dark:text-red-400">${t.follow_atention.Falla??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-yellow-700 dark:text-yellow-400">${t.follow_atention.Causa??""}</td>
            <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200">${t.follow_atention.Accion??""}</td>
        `,r.appendChild(c)})},S=document.getElementById("copy-table-btn"),T=document.getElementById("save-table-btn"),g=document.getElementById("save-modal"),L=document.getElementById("close-modal-btn"),B=document.getElementById("download-excel-btn"),D=document.getElementById("download-pdf-btn");S&&S.addEventListener("click",()=>O(C));T&&T.addEventListener("click",()=>{g&&g.classList.remove("hidden")});L&&L.addEventListener("click",()=>{g&&g.classList.add("hidden")});B&&B.addEventListener("click",()=>{P(C),g&&g.classList.add("hidden")});D&&D.addEventListener("click",()=>{N(C),g&&g.classList.add("hidden")});const J=async()=>{let e=await q();z(e)};document.addEventListener("DOMContentLoaded",J);
