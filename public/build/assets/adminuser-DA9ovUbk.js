(()=>{const i=()=>{const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""},h=e=>{const o=document.getElementById("users-table-body");o&&(o.innerHTML=e.map(t=>`
            <tr>
                <td class="p-4"><input type="checkbox"></td>
                <td class="px-6 py-3">${a(t.num_empleado)}</td>
                <td class="px-6 py-3">${a(t.name)}</td>
                <td class="px-6 py-3">${a(t.puesto)}</td>
                <td class="px-6 py-3">${a(t.status)}</td>
                <td class="px-6 py-3">
                    <button class="edit-btn text-blue-500" data-id="${a(t.id)}">Editar</button>
                    <span class="mx-2">|</span>
                    <button class="delete-btn text-red-500" data-id="${a(t.id)}">Eliminar</button>
                </td>
            </tr>
        `).join(""))},a=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),u=()=>{fetch(window.USERS_ROUTE,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(e=>{if(!e.ok)throw new Error("Error en la respuesta del servidor");return e.json()}).then(e=>h(e)).catch(e=>console.error("Error cargando usuarios:",e))},f=()=>{const e=document.getElementById("table-search-users"),o=document.getElementById("users-table-body");!e||!o||e.addEventListener("keyup",()=>{const t=e.value.toLowerCase();o.querySelectorAll("tr").forEach(n=>{const s=n.children[2].textContent.toLowerCase();n.style.display=s.includes(t)?"":"none"})})},g=(e,o=null)=>{const t=document.getElementById(e);t&&fetch("/admin-control/puestos",{headers:{"X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(n=>n.json()).then(n=>{t.innerHTML='<option value="">Seleccione un puesto</option>'+n.map(s=>`<option value="${a(s)}"${o&&s===o?" selected":""}>${a(s)}</option>`).join("")}).catch(()=>{t.innerHTML='<option value="">Error al cargar puestos</option>'})},y=()=>{const e=document.getElementById("editUserModal"),o=document.querySelectorAll(".close-edit-user-modal"),t=document.getElementById("editUserForm"),n=document.getElementById("edit-user-id"),s=document.getElementById("edit-name"),m=document.getElementById("edit-email"),E=document.getElementById("edit-puesto"),p=document.getElementById("edit-password");if(!e||!t||!n||!s||!m||!E){console.error("Error: No se encontraron algunos elementos en el DOM.");return}document.addEventListener("click",d=>{if(d.target.classList.contains("edit-btn")&&d.target.id!=="btn-open-usercreate"){const c=d.target.getAttribute("data-id");c?fetch(`/admin-control/users/${encodeURIComponent(c)}`,{headers:{"X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(r=>{if(!r.ok)throw new Error("No se pudo obtener el usuario");return r.json()}).then(r=>{if(!r)throw new Error("Datos de usuario vacíos");n.value=r.id,s.value=r.name,m.value=r.email,g("edit-puesto",r.puesto),e.classList.remove("hidden"),e.classList.add("flex")}).catch(r=>{console.error("Error obteniendo usuario:",r),alert("No se pudo cargar el usuario.")}):console.error("Error: No se encontró el ID del usuario.")}}),o.forEach(d=>{d.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex")})}),t.addEventListener("submit",d=>{d.preventDefault();const c=n.value,r={name:s.value,email:m.value,puesto:E.value};p&&p.value.trim()!==""&&(r.password=p.value),fetch(`/admin-control/users/${encodeURIComponent(c)}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(r)}).then(l=>{if(!l.ok)throw new Error("Error actualizando usuario");return l.json()}).then(()=>{Swal.fire("Actualizado","Usuario actualizado correctamente","success"),e.classList.add("hidden"),e.classList.remove("flex"),u()}).catch(l=>{console.error("Error actualizando usuario:",l),Swal.fire("Error","No se pudo actualizar el usuario.","error")})})},b=()=>{document.addEventListener("click",e=>{if(e.target.classList.contains("delete-btn")){const o=e.target.getAttribute("data-id");if(!o)return;Swal.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&fetch(`/admin-control/users/${encodeURIComponent(o)}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(n=>{if(!n.ok)throw new Error("Error eliminando usuario");return n.json()}).then(()=>{Swal.fire("Eliminado","El usuario ha sido eliminado.","success"),u()}).catch(n=>{console.error("Error eliminando usuario:",n),Swal.fire("Error","No se pudo eliminar el usuario.","error")})})}})};document.addEventListener("DOMContentLoaded",()=>{var e,o;window.USERS_ROUTE||(window.USERS_ROUTE=((o=(e=document.getElementById("users-table-body"))==null?void 0:e.dataset)==null?void 0:o.usersRoute)||"/admin-control/users"),u(),f(),y(),b()})})();
