import{S as C,r as O,e as K}from"./transform-oMh35NN8.js";function b(e){return typeof e=="string"?new C([[document.querySelector(e)]],[document.documentElement]):new C([[e]],O)}function Q(e){return b(K(e).call(document.documentElement))}function R(e){return new C([document.querySelectorAll(e)],[document.documentElement])}function q(e){const o=document.getElementById("timeline-container");if(!o)return;o.innerHTML=`
        <div class="flex text-2xl font-medium tracking-tight text-gray-950 dark:text-white mb-4">
            Línea de tiempo de atención
        </div>
    `;const l=[...new Set(e.map(a=>a.Mecanico).filter(Boolean))],s=[...new Set(e.map(a=>a.Modulo).filter(Boolean))];let n=document.getElementById("timeline-filters");n?n.innerHTML="":(n=document.createElement("div"),n.id="timeline-filters",n.className="flex flex-wrap gap-4 mb-6 items-center",o.appendChild(n));const r=document.createElement("select");r.className="select2-mecanico border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",r.innerHTML='<option value="">Todos los Mecánicos</option>'+l.map(a=>`<option value="${a}">${a}</option>`).join(""),n.appendChild(r);const g=document.createElement("select");g.className="select2-modulo border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",g.innerHTML='<option value="">Todos los Módulos</option>'+s.map(a=>`<option value="${a}">${a}</option>`).join(""),n.appendChild(g);function $(){o.querySelectorAll(".w-full.mb-8").forEach(t=>t.remove());const a=r.value,L=g.value;let y=e;a&&(y=y.filter(t=>t.Mecanico===a)),L&&(y=y.filter(t=>t.Modulo===L));const _=t=>new Date(t).toLocaleDateString(),A=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});y.forEach((t,B)=>{const d=new Date(t.AsignationCreated),N=new Date(t.FollowCreated),k=(t.TimeFin?new Date(t.TimeFin):N)-d||1;let M=null,T=null;if(t.TimeInicio){const i=new Date(t.FollowCreated),[p,m]=t.TimeInicio.split(":");M=new Date(i),M.setHours(Number(p),Number(m),0,0),T=(M-d)/k}const z=0,G=(N-d)/k,J=1,I=700,D=44,f={left:30,right:30},u=document.createElement("div");u.className="w-full mb-8",u.innerHTML=`
            <div class="mb-2 text-sm font-semibold break-all text-left text-gray-800 dark:text-gray-100">Modulo: ${t.Modulo}</div>`,o.appendChild(u);const x=Q("svg").attr("width","100%").attr("viewBox",`0 0 ${I} ${D}`).classed("block",!0);x.append("rect").attr("x",f.left).attr("y",D/2-4).attr("width",I-f.left-f.right).attr("height",8).attr("rx",4).attr("fill","url(#timeline-gradient)");const S=x.append("defs").append("linearGradient").attr("id","timeline-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");S.append("stop").attr("offset","0%").attr("stop-color","#ef4444"),S.append("stop").attr("offset","60%").attr("stop-color","#f59e42"),S.append("stop").attr("offset","100%").attr("stop-color","#22c55e");function h(i,p,m,c,w=""){const j=f.left+i*(I-f.left-f.right);x.append("circle").attr("cx",j).attr("cy",D/2).attr("r",8).attr("fill",p).attr("stroke","#374151").attr("stroke-width",3).attr("class","timeline-point").attr("data-tooltip",`
                        <div class='font-bold mb-1 text-gray-800 dark:text-gray-100'>${m}</div>
                        <div class='text-xs mb-1 text-gray-800 dark:text-gray-100'>
                            <span class='font-semibold'>Fecha:</span> ${_(c)}<br>
                            <span class='font-semibold'>Hora:</span> ${A(c)}
                        </div>
                        <div class='text-gray-800 dark:text-gray-100'>${w}</div>
                    `),x.append("text").attr("x",j).attr("y",D/2+18).attr("text-anchor","middle").attr("class","fill-gray-800 dark:fill-gray-100 text-xs").text(A(c))}const v=`
                <div><span class='font-semibold'>Folio:</span> ${t.Folio}</div>
                <div><span class='font-semibold'>Módulo:</span> ${t.Modulo}</div>
                <div><span class='font-semibold'>Problema:</span> ${t.Problema}</div>
                <div><span class='font-semibold'>Máquina:</span> ${t.Maquina}</div>
                <div><span class='font-semibold'>Mecánico:</span> ${t.Mecanico}</div>
            `;h(z,"#ef4444","Inicio",t.AsignationCreated,v);const H=t.TimeInicio?new Date(t.TimeInicio):null;let Y=null;t.TimeInicio&&(Y=(H-d)/k,h(Y,"#f59e42","Inicio Atención",H,v)),h(G,"#3b82f6","Atención",t.FollowCreated,v),T!==null&&!isNaN(T)&&h(T,"#fde047","TimeInicio",M,v),h(J,"#22c55e","Fin",t.TimeFin?t.TimeFin:t.FollowCreated,v),u.appendChild(x.node());const F=document.createElement("div");if(F.className="flex justify-between w-full min-w-[340px] mt-2 text-xs font-semibold text-gray-800 dark:text-gray-100",F.innerHTML=`
                <span>Inicio</span>
                <span>Fin</span>
            `,u.appendChild(F),typeof t.TiempoAtencionMin<"u"&&t.TiempoAtencionMin!==null){let i=t.TiempoAtencionMin,p=Math.floor(i/1440);i=i%1440;let m=Math.floor(i/60);i=i%60;let c=[];p>0&&c.push(`${p} día${p>1?"s":""}`),m>0&&c.push(`${m} hora${m>1?"s":""}`),(i>0||c.length===0)&&c.push(`${i} min`);const w=document.createElement("div");w.className="mt-2 text-center text-sm font-bold text-gray-800 dark:text-gray-100",w.innerText=`Tiempo completo: ${c.join(" : ")}`,u.appendChild(w)}}),R(".timeline-point").on("mouseenter",function(t){const B=this.getAttribute("data-tooltip");let d=b("#d3-timeline-tooltip");d.empty()&&(d=b("body").append("div").attr("id","d3-timeline-tooltip").attr("class","z-50 fixed pointer-events-none px-4 py-2 rounded-lg shadow-lg bg-gray-900 text-white text-xs").style("opacity",0)),d.html(B).style("opacity",1).style("left",t.clientX+10+"px").style("top",t.clientY-10+"px")}).on("mousemove",function(t){b("#d3-timeline-tooltip").style("left",t.clientX+10+"px").style("top",t.clientY-10+"px")}).on("mouseleave",function(){b("#d3-timeline-tooltip").style("opacity",0)})}r.addEventListener("change",$),g.addEventListener("change",$),$()}function P(){const e=document.getElementById("calendar-month"),o=document.getElementById("calendar-year"),l=document.getElementById("calendar-day"),s=e?parseInt(e.value,10):new Date().getMonth(),n=o?parseInt(o.value,10):new Date().getFullYear(),r=l&&l.value?parseInt(l.value,10):null;return{month:s,year:n,day:r}}function X(e,o,l,s){return e.filter(n=>{if(!n.created_at)return!1;const r=new Date(n.created_at);return!(r.getFullYear()!==o||r.getMonth()!==l||s!==null&&r.getDate()!==s)})}let E=null;function U(){fetch("/dashboard/timeline-data").then(e=>e.json()).then(e=>{E=e;const{month:o,year:l,day:s}=P(),n=X(E,l,o,s);q(n)}).catch(e=>{console.error("Error al obtener la línea de tiempo:",e)})}window.addEventListener("calendar:change",()=>{if(E){const{month:e,year:o,day:l}=P(),s=X(E,o,e,l);q(s)}});document.addEventListener("DOMContentLoaded",U);
