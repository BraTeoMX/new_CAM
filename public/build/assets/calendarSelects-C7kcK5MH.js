let c=[],r=[];function S(){try{localStorage.setItem("calendarData",JSON.stringify(c)),localStorage.setItem("calendarDates",JSON.stringify(r))}catch{}}function b(){try{const t=localStorage.getItem("calendarData"),a=localStorage.getItem("calendarDates");c=t?JSON.parse(t):[],r=a?JSON.parse(a):[]}catch{c=[],r=[]}}async function N(){var M;const t=document.getElementById("calendar-month"),a=document.getElementById("calendar-year"),l=document.getElementById("calendar-day");if(!t||!a||!l)return;b();let g=!1;try{let f=function(e){t.innerHTML="";const n=[...new Set(r.filter(o=>o.year===e).map(o=>o.month))];for(let o=0;o<12;o++)if(n.includes(o)){const s=document.createElement("option");s.value=o,s.textContent=m[o],t.appendChild(s)}},v=function(e,n){l.innerHTML="";const o=document.createElement("option");o.value="",o.textContent="Todos",l.appendChild(o),[...new Set(r.filter(u=>u.year===e&&u.month===n).map(u=>u.day))].sort((u,p)=>u-p).forEach(u=>{const p=document.createElement("option");p.value=u,p.textContent=u,l.appendChild(p)})},h=function(){const e={year:Number(a.value),month:Number(t.value),day:l.value?Number(l.value):null};window.dispatchEvent(new CustomEvent("calendar:change",{detail:e}))};var C=f,D=v,L=h;if(c.length||(c=await window.getCardsAteOTsData(),g=!0),!r.length&&c.length&&(r=c.map(e=>e.created_at).filter(Boolean).map(e=>{const n=new Date(e);return{year:n.getFullYear(),month:n.getMonth(),day:n.getDate()}}),g=!0),g&&S(),(!c.length||!r.length)&&b(),!c.length||!r.length)throw new Error("No data");const E=[...new Set(r.map(e=>e.year))].sort((e,n)=>e-n);a.innerHTML="",E.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=e,a.appendChild(n)});const m=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],w=new Date;let d=w.getFullYear(),i=w.getMonth();if(!r.some(e=>e.year===d&&e.month===i)){let e=i-1,n=d;e<0&&(e=11,n=d-1),r.some(s=>s.year===n&&s.month===e)?(d=n,i=e):(d=Number((M=a.options[0])==null?void 0:M.value),i=void 0)}f(d);let y=Array.from(t.options).map(e=>Number(e.value));(i===void 0||!y.includes(i))&&(i=y.length>0?y[0]:0),a.value=d,t.value=i,v(d,i),l.value="",h(),a.addEventListener("change",()=>{var e;f(Number(a.value)),t.value=(e=t.options[0])==null?void 0:e.value,v(Number(a.value),Number(t.value)),l.value="",h()}),t.addEventListener("change",()=>{v(Number(a.value),Number(t.value)),l.value="",h()}),l.addEventListener("change",()=>{h()})}catch{if(b(),c.length&&r.length){N();return}const m=new Date;a.innerHTML=`<option value="${m.getFullYear()}">${m.getFullYear()}</option>`,t.innerHTML=`<option value="${m.getMonth()}">${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][m.getMonth()]}</option>`,l.innerHTML='<option value="">Todos</option>',window.dispatchEvent(new Event("calendar:change"))}}document.addEventListener("DOMContentLoaded",N);
