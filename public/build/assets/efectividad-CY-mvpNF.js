window.EfectividadState={efectividad:0,total:0,efectivos:0,lastParams:{year:null,month:null,day:null}};function n(){const e=document.getElementById("dashboard-tops");if(!e)return{};e.innerHTML="";let a=document.createElement("div");a.id="efectividad-gauge",a.className="w-full",e.appendChild(a);let t=document.createElement("div");return t.id="efectividad-info",t.className="text-center mt-4 text-base font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 rounded-lg py-2 px-4 shadow border border-gray-200 dark:border-gray-700",e.appendChild(t),{topsDiv:e,gaugeDiv:a,infoDiv:t}}function s(){if(typeof Highcharts>"u"){const{topsDiv:i}=n();i&&(i.innerHTML=`
                <div class="text-center p-4 rounded-lg bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700 shadow">
                    <span class="font-bold">Error:</span> Highcharts no está cargado.<br>
                    <span class="text-sm">Asegúrate de incluir la librería Highcharts antes de este script.</span>
                </div>
            `);return}const{gaugeDiv:e,infoDiv:a}=n();if(!e||!a)return;e.innerHTML="";const t=document.documentElement.classList.contains("dark"),d=t?"#1e293b":"#fff",r=t?"#f1f5f9":"#1e293b";Highcharts.chart(e.id,{chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1,height:"80%",backgroundColor:d},title:{text:"Efectividad de Atención",style:{color:r,fontWeight:"bold"}},pane:{startAngle:-90,endAngle:89.9,background:null,center:["50%","75%"],size:"110%"},yAxis:{min:0,max:100,tickPixelInterval:72,tickPosition:"inside",tickColor:d,tickLength:20,tickWidth:2,minorTickInterval:null,labels:{distance:20,style:{fontSize:"14px",color:r}},lineWidth:0,plotBands:[{from:0,to:70,color:"#DF5353",thickness:20,borderRadius:"50%"},{from:70,to:90,color:"#DDDF0D",thickness:20},{from:90,to:100,color:"#55BF3B",thickness:20,borderRadius:"50%"}]},series:[{name:"Efectividad",data:[window.EfectividadState.efectividad],tooltip:{valueSuffix:" %"},dataLabels:{format:"{y} %",borderWidth:0,color:r,style:{fontSize:"16px",color:r}},dial:{radius:"80%",backgroundColor:t?"#64748b":"gray",baseWidth:12,baseLength:"0%",rearLength:"0%"},pivot:{backgroundColor:t?"#64748b":"gray",radius:6}}],credits:{enabled:!1}}),a.innerHTML=`
        <span class="text-gray-600 dark:text-gray-300">Tickets efectivos:</span>
        <b class="text-emerald-600 dark:text-emerald-400">${window.EfectividadState.efectivos}</b>
        <span class="text-gray-400 dark:text-gray-500">/</span>
        <b class="text-blue-600 dark:text-blue-400">${window.EfectividadState.total}</b>
    `}async function o(e){const a=window.EfectividadState.lastParams;if(!(a.year===e.year&&a.month===e.month&&a.day===e.day)){window.EfectividadState.lastParams={...e};try{const t=new URLSearchParams;e.year&&t.append("year",e.year),e.month!==void 0&&e.month!==null&&t.append("month",e.month),e.day&&t.append("day",e.day);const d=await fetch(`/dashboard/efectividad?${t.toString()}`,{method:"GET",headers:{Accept:"application/json"}});if(!d.ok)throw new Error("Error al obtener datos de efectividad");const r=await d.json();window.EfectividadState.efectividad=Number(r.efectividad)||0,window.EfectividadState.total=Number(r.total)||0,window.EfectividadState.efectivos=Number(r.efectivos)||0,s()}catch(t){const{topsDiv:d}=n();d&&(d.innerHTML=`
                <div class="text-center p-4 rounded-lg bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700 shadow">
                    <span class="font-bold">Error:</span> No se pudo cargar la efectividad.<br>
                    <span class="text-sm">${t.message}</span>
                </div>
            `)}}}window.addEventListener("calendar:change",e=>{const a=e.detail||{};o({year:a.year,month:a.month,day:a.day||null})});document.addEventListener("DOMContentLoaded",()=>{o({year:new Date().getFullYear(),month:new Date().getMonth(),day:null})});
