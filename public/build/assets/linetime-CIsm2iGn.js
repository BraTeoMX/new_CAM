import{S as C,r as z,e as G}from"./transform-oMh35NN8.js";function v(e){return typeof e=="string"?new C([[document.querySelector(e)]],[document.documentElement]):new C([[e]],z)}function J(e){return v(G(e).call(document.documentElement))}function O(e){return new C([document.querySelectorAll(e)],[document.documentElement])}function K(e){const r=document.getElementById("timeline-container");if(!r)return;r.innerHTML="";const B=[...new Set(e.map(n=>n.Mecanico).filter(Boolean))],j=[...new Set(e.map(n=>n.Modulo).filter(Boolean))];let a=document.getElementById("timeline-filters");a?a.innerHTML="":(a=document.createElement("div"),a.id="timeline-filters",a.className="flex flex-wrap gap-4 mb-6 items-center",r.appendChild(a));const m=document.createElement("select");m.className="select2-mecanico border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",m.innerHTML='<option value="">Todos los Mecánicos</option>'+B.map(n=>`<option value="${n}">${n}</option>`).join(""),a.appendChild(m);const f=document.createElement("select");f.className="select2-modulo border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",f.innerHTML='<option value="">Todos los Módulos</option>'+j.map(n=>`<option value="${n}">${n}</option>`).join(""),a.appendChild(f);function T(){r.querySelectorAll(".w-full.mb-8").forEach(t=>t.remove());const n=m.value,F=f.value;let u=e;n&&(u=u.filter(t=>t.Mecanico===n)),F&&(u=u.filter(t=>t.Modulo===F));const q=t=>new Date(t).toLocaleDateString(),I=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});u.forEach((t,S)=>{const l=new Date(t.AsignationCreated),A=new Date(t.FollowCreated),$=(t.TimeFin?new Date(t.TimeFin):A)-l||1;let b=null,w=null;if(t.TimeInicio){const o=new Date(t.FollowCreated),[s,c]=t.TimeInicio.split(":");b=new Date(o),b.setHours(Number(s),Number(c),0,0),w=(b-l)/$}const P=0,X=(A-l)/$,Y=1,D=700,M=44,d={left:30,right:30},p=document.createElement("div");p.className="w-full mb-8",p.innerHTML=`<div class="mb-2 text-sm font-semibold break-all text-left text-gray-800 dark:text-gray-100">Modulo: ${t.Modulo}</div>`,r.appendChild(p);const g=J("svg").attr("width","100%").attr("viewBox",`0 0 ${D} ${M}`).classed("block",!0);g.append("rect").attr("x",d.left).attr("y",M/2-4).attr("width",D-d.left-d.right).attr("height",8).attr("rx",4).attr("fill","url(#timeline-gradient)");const E=g.append("defs").append("linearGradient").attr("id","timeline-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");E.append("stop").attr("offset","0%").attr("stop-color","#22c55e"),E.append("stop").attr("offset","60%").attr("stop-color","#f59e42"),E.append("stop").attr("offset","100%").attr("stop-color","#ef4444");function x(o,s,c,i,h=""){const H=d.left+o*(D-d.left-d.right);g.append("circle").attr("cx",H).attr("cy",M/2).attr("r",8).attr("fill",s).attr("stroke","#374151").attr("stroke-width",3).attr("class","timeline-point").attr("data-tooltip",`
                        <div class='font-bold mb-1 text-gray-800 dark:text-gray-100'>${c}</div>
                        <div class='text-xs mb-1 text-gray-800 dark:text-gray-100'>
                            <span class='font-semibold'>Fecha:</span> ${q(i)}<br>
                            <span class='font-semibold'>Hora:</span> ${I(i)}
                        </div>
                        <div class='text-gray-800 dark:text-gray-100'>${h}</div>
                    `),g.append("text").attr("x",H).attr("y",M/2+18).attr("text-anchor","middle").attr("class","fill-gray-800 dark:fill-gray-100 text-xs").text(I(i))}const y=`
                <div><span class='font-semibold'>Folio:</span> ${t.Folio}</div>
                <div><span class='font-semibold'>Módulo:</span> ${t.Modulo}</div>
                <div><span class='font-semibold'>Problema:</span> ${t.Problema}</div>
                <div><span class='font-semibold'>Máquina:</span> ${t.Maquina}</div>
                <div><span class='font-semibold'>Mecánico:</span> ${t.Mecanico}</div>
            `;x(P,"#22c55e","Inicio",t.AsignationCreated,y);const L=t.TimeInicio?new Date(t.TimeInicio):null;let N=null;t.TimeInicio&&(N=(L-l)/$,x(N,"#f59e42","Inicio Atención",L,y)),x(X,"#3b82f6","Atención",t.FollowCreated,y),w!==null&&!isNaN(w)&&x(w,"#fde047","TimeInicio",b,y),x(Y,"#ef4444","Fin",t.TimeFin?t.TimeFin:t.FollowCreated,y),p.appendChild(g.node());const k=document.createElement("div");if(k.className="flex justify-between w-full min-w-[340px] mt-2 text-xs font-semibold text-gray-800 dark:text-gray-100",k.innerHTML=`
                <span>Inicio</span>
                <span>Fin</span>
            `,p.appendChild(k),typeof t.TiempoAtencionMin<"u"&&t.TiempoAtencionMin!==null){let o=t.TiempoAtencionMin,s=Math.floor(o/1440);o=o%1440;let c=Math.floor(o/60);o=o%60;let i=[];s>0&&i.push(`${s} día${s>1?"s":""}`),c>0&&i.push(`${c} hora${c>1?"s":""}`),(o>0||i.length===0)&&i.push(`${o} min`);const h=document.createElement("div");h.className="mt-2 text-center text-sm font-bold text-gray-800 dark:text-gray-100",h.innerText=`Tiempo completo: ${i.join(" : ")}`,p.appendChild(h)}}),O(".timeline-point").on("mouseenter",function(t){const S=this.getAttribute("data-tooltip");let l=v("#d3-timeline-tooltip");l.empty()&&(l=v("body").append("div").attr("id","d3-timeline-tooltip").attr("class","z-50 fixed pointer-events-none px-4 py-2 rounded-lg shadow-lg bg-gray-900 text-white text-xs").style("opacity",0)),l.html(S).style("opacity",1).style("left",t.clientX+10+"px").style("top",t.clientY-10+"px")}).on("mousemove",function(t){v("#d3-timeline-tooltip").style("left",t.clientX+10+"px").style("top",t.clientY-10+"px")}).on("mouseleave",function(){v("#d3-timeline-tooltip").style("opacity",0)})}m.addEventListener("change",T),f.addEventListener("change",T),T()}async function Q(){try{const r=await(await fetch("/dashboard/timeline-data")).json();K(r)}catch(e){console.error("Error al obtener la línea de tiempo:",e)}}document.addEventListener("DOMContentLoaded",Q);
