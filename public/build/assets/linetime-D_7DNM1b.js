import{S as _,r as ee,c as te}from"./transform-BG7eE8b0.js";function S(t){return typeof t=="string"?new _([[document.querySelector(t)]],[document.documentElement]):new _([[t]],ee)}function ne(t){return S(te(t).call(document.documentElement))}function ae(t){return new _([document.querySelectorAll(t)],[document.documentElement])}function R(t){const o=document.getElementById("timeline-container");if(!o)return;o.innerHTML=`
        <div class="flex text-2xl font-medium tracking-tight text-gray-950 dark:text-white mb-4">
            Línea de tiempo de atención
        </div>
    `;const i=n=>new Date(n).toLocaleDateString(),l=n=>new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),c=[...new Set(t.map(n=>n.Mecanico).filter(Boolean))],y=[...new Set(t.map(n=>n.Modulo).filter(Boolean))];let p=document.getElementById("timeline-filters");p?p.innerHTML="":(p=document.createElement("div"),p.id="timeline-filters",p.className="flex flex-wrap gap-4 mb-6 items-center",o.appendChild(p));const T=document.createElement("select");T.className="select2-mecanico border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",T.innerHTML='<option value="">Todos los Mecánicos</option>'+c.map(n=>`<option value="${n}">${n}</option>`).join(""),p.appendChild(T);const D=document.createElement("select");D.className="select2-modulo border rounded px-2 py-1 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100",D.innerHTML='<option value="">Todos los Módulos</option>'+y.map(n=>`<option value="${n}">${n}</option>`).join(""),p.appendChild(D);const H=5;let a=1,m=1,u=document.getElementById("timeline-pagination");u?u.innerHTML="":(u=document.createElement("div"),u.id="timeline-pagination",u.className="flex justify-center mt-4",o.appendChild(u));function w(){o.querySelectorAll(".w-full.mb-8").forEach(e=>e.remove());const n=T.value,g=D.value;let d=t;n&&(d=d.filter(e=>e.Mecanico===n)),g&&(d=d.filter(e=>e.Modulo===g)),m=Math.ceil(d.length/H),a>m&&(a=m||1);const M=(a-1)*H,h=M+H;d.slice(M,h).forEach((e,G)=>{const f=new Date(e.AsignationCreated),X=new Date(e.FollowCreated),P=(e.TimeFin?new Date(e.TimeFin):X)-f||1;let A=null,B=null;if(e.TimeInicio){const r=new Date(e.FollowCreated),[b,v]=e.TimeInicio.split(":");A=new Date(r),A.setHours(Number(b),Number(v),0,0),B=(A-f)/P}const V=0,W=(X-f)/P,Z=1,j=700,F=44,k={left:30,right:30},E=document.createElement("div");E.className="w-full mb-8",E.innerHTML=`
            <div class="mb-2 text-sm font-semibold break-all text-left text-gray-800 dark:text-gray-100">Modulo: ${e.Modulo}</div>`,o.appendChild(E);const $=ne("svg").attr("width","100%").attr("viewBox",`0 0 ${j} ${F}`).classed("block",!0);$.append("rect").attr("x",k.left).attr("y",F/2-4).attr("width",j-k.left-k.right).attr("height",8).attr("rx",4).attr("fill","url(#timeline-gradient)");const Y=$.append("defs").append("linearGradient").attr("id","timeline-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");Y.append("stop").attr("offset","0%").attr("stop-color","#ef4444"),Y.append("stop").attr("offset","60%").attr("stop-color","#f59e42"),Y.append("stop").attr("offset","100%").attr("stop-color","#22c55e");function I(r,b,v,s,L=""){const O=k.left+r*(j-k.left-k.right);$.append("circle").attr("cx",O).attr("cy",F/2).attr("r",8).attr("fill",b).attr("stroke-width",3).attr("class","timeline-point").attr("data-tooltip",`
                        <div class='font-bold mb-1 bg-white dark:bg-gray-800  text-gray-800 dark:text-gray-100'>${v}</div>
                        <div class='text-xs mb-1 bg-white dark:bg-gray-800  text-gray-800 dark:text-gray-100'>
                            <span class='font-semibold'>Fecha:</span> ${i(s)}<br>
                            <span class='font-semibold'>Hora:</span> ${l(s)}
                        </div>
                        <div class='bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100'>${L}</div>
                    `),$.append("text").attr("x",O).attr("y",F/2+18).attr("text-anchor","middle").attr("class","fill-gray-800 dark:fill-gray-100 text-xs").text(l(s))}const C=`
                <div><span class='font-semibold'>Folio:</span> ${e.Folio}</div>
                <div><span class='font-semibold'>Módulo:</span> ${e.Modulo}</div>
                <div><span class='font-semibold'>Problema:</span> ${e.Problema}</div>
                <div><span class='font-semibold'>Máquina:</span> ${e.Maquina}</div>
                <div><span class='font-semibold'>Mecánico:</span> ${e.Mecanico}</div>
            `;I(V,"#ef4444","Inicio",e.AsignationCreated,C);const z=e.TimeInicio?new Date(e.TimeInicio):null;let J=null;e.TimeInicio&&(J=(z-f)/P,I(J,"#f59e42","Inicio Atención",z,C)),I(W,"#3b82f6","Atención",e.FollowCreated,C),B!==null&&!isNaN(B)&&I(B,"#fde047","TimeInicio",A,C),I(Z,"#22c55e","Fin",e.TimeFin?e.TimeFin:e.FollowCreated,C),E.appendChild($.node());const q=document.createElement("div");if(q.className="flex justify-between w-full min-w-[340px] mt-2 text-xs font-semibold text-gray-800 dark:text-gray-100",q.innerHTML=`
                <span>Inicio</span>
                <span>Fin</span>
            `,E.appendChild(q),typeof e.TiempoAtencionMin<"u"&&e.TiempoAtencionMin!==null){let r=e.TiempoAtencionMin,b=Math.floor(r/1440);r=r%1440;let v=Math.floor(r/60);r=r%60;let s=[];b>0&&s.push(`${b} día${b>1?"s":""}`),v>0&&s.push(`${v} hora${v>1?"s":""}`),(r>0||s.length===0)&&s.push(`${r} min`);const L=document.createElement("div");L.className="mt-2 text-center text-sm font-bold text-gray-800 dark:text-gray-100",L.innerText=`Tiempo completo: ${s.join(" : ")}`,E.appendChild(L)}}),U(),ae(".timeline-point").on("mouseenter",function(e){const G=this.getAttribute("data-tooltip");let f=S("#d3-timeline-tooltip");f.empty()&&(f=S("body").append("div").attr("id","d3-timeline-tooltip").attr("class","z-50 fixed pointer-events-none px-4 py-2 rounded-lg shadow-lg bg-gray-900 text-white text-xs").style("opacity",0)),f.html(G).style("opacity",1).style("left",e.clientX+10+"px").style("top",e.clientY-10+"px")}).on("mousemove",function(e){S("#d3-timeline-tooltip").style("left",e.clientX+10+"px").style("top",e.clientY-10+"px")}).on("mouseleave",function(){S("#d3-timeline-tooltip").style("opacity",0)})}function U(){if(u.innerHTML="",m<=1)return;const n=document.createElement("nav");n.setAttribute("aria-label","Paginación"),n.className="flex items-center space-x-2";const g=document.createElement("button");g.className=`flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 ${a===1?"opacity-50 cursor-not-allowed":""}`,g.innerHTML='<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>Anterior',g.disabled=a===1,g.addEventListener("click",()=>{a>1&&(a--,w())}),n.appendChild(g);let d=Math.max(1,a-2),M=Math.min(m,d+4);M-d<4&&(d=Math.max(1,M-4));for(let x=d;x<=M;x++){const e=document.createElement("button");e.className=`px-3 py-2 text-sm font-medium border border-gray-300 ${x===a?"bg-blue-600 text-white dark:bg-blue-500":"bg-white text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700"}`,e.innerText=x,x===a&&e.setAttribute("aria-current","page"),e.addEventListener("click",()=>{a=x,w()}),n.appendChild(e)}const h=document.createElement("button");h.className=`flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700 ${a===m?"opacity-50 cursor-not-allowed":""}`,h.innerHTML='Siguiente<svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>',h.disabled=a===m,h.addEventListener("click",()=>{a<m&&(a++,w())}),n.appendChild(h),u.appendChild(n)}T.addEventListener("change",()=>{a=1,w()}),D.addEventListener("change",()=>{a=1,w()}),w()}function K(){const t=document.getElementById("calendar-month"),o=document.getElementById("calendar-year"),i=document.getElementById("calendar-day"),l=t?parseInt(t.value,10):new Date().getMonth(),c=o?parseInt(o.value,10):new Date().getFullYear(),y=i&&i.value?parseInt(i.value,10):null;return{month:l,year:c,day:y}}function Q(t,o,i,l){return t.filter(c=>{if(!c.created_at)return!1;const y=new Date(c.created_at);return!(y.getFullYear()!==o||y.getMonth()!==i||l!==null&&y.getDate()!==l)})}let N=null;function oe(){fetch("/dashboard/timeline-data").then(t=>t.json()).then(t=>{N=t;const{month:o,year:i,day:l}=K(),c=Q(N,i,o,l);R(c)}).catch(t=>{console.error("Error al obtener la línea de tiempo:",t)})}window.addEventListener("calendar:change",()=>{if(N){const{month:t,year:o,day:i}=K(),l=Q(N,o,t,i);R(l)}});document.addEventListener("DOMContentLoaded",oe);
