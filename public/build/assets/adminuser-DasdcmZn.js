(()=>{const i=()=>{const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""},h=e=>{const t=document.getElementById("users-table-body");t&&(t.innerHTML=e.map(o=>`
            <tr>
                <td class="p-4"><input type="checkbox"></td>
                <td class="px-6 py-3">${a(o.num_empleado)}</td>
                <td class="px-6 py-3">${a(o.name)}</td>
                <td class="px-6 py-3">${a(o.puesto)}</td>
                <td class="px-6 py-3">${a(o.status)}</td>
                <td class="px-6 py-3">
                    <button class="edit-btn text-blue-500" data-id="${a(o.num_empleado)}">Editar</button>
                    <span class="mx-2">|</span>
                    <button class="delete-btn text-red-500" data-id="${a(o.num_empleado)}">Eliminar</button>
                </td>
            </tr>
        `).join(""))},a=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),p=()=>{fetch(window.USERS_ROUTE,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(e=>{if(!e.ok)throw new Error("Error en la respuesta del servidor");return e.json()}).then(e=>h(e)).catch(e=>console.error("Error cargando usuarios:",e))},g=()=>{const e=document.getElementById("table-search-users"),t=document.getElementById("users-table-body");!e||!t||e.addEventListener("keyup",()=>{const o=e.value.toLowerCase();t.querySelectorAll("tr").forEach(n=>{const r=n.children[2].textContent.toLowerCase();n.style.display=r.includes(o)?"":"none"})})},E=(e,t=null)=>{const o=document.getElementById(e);o&&fetch("/admin-control/puestos",{headers:{"X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(n=>n.json()).then(n=>{o.innerHTML='<option value="">Seleccione un puesto</option>'+n.map(r=>`<option value="${a(r)}"${t&&r===t?" selected":""}>${a(r)}</option>`).join("")}).catch(()=>{o.innerHTML='<option value="">Error al cargar puestos</option>'})},y=()=>{const e=document.getElementById("editUserModal"),t=document.querySelectorAll(".close-edit-user-modal"),o=document.getElementById("editUserForm"),n=document.getElementById("edit-user-id"),r=document.getElementById("edit-name"),l=document.getElementById("edit-email"),u=document.getElementById("edit-puesto");if(!e||!o||!n||!r||!l||!u){console.error("Error: No se encontraron algunos elementos en el DOM.");return}const c=d=>{fetch(`/admin-control/users/${encodeURIComponent(d)}`,{headers:{"X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(s=>{if(!s.ok)throw new Error("No se pudo obtener el usuario");return s.json()}).then(s=>{if(!s)throw new Error("Datos de usuario vacíos");n.value=s.num_empleado,r.value=s.name,l.value=s.email,E("edit-puesto",s.puesto),e.classList.remove("hidden"),e.classList.add("flex")}).catch(s=>{console.error("Error obteniendo usuario:",s),alert("No se pudo cargar el usuario.")})};document.addEventListener("click",d=>{if(d.target.classList.contains("edit-btn")){const s=d.target.getAttribute("data-id");s?c(s):console.error("Error: No se encontró el ID del usuario.")}}),t.forEach(d=>{d.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex")})}),o.addEventListener("submit",d=>{d.preventDefault();const s=n.value,v={name:r.value,email:l.value,puesto:u.value};fetch(`/admin-control/users/${encodeURIComponent(s)}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(v)}).then(m=>{if(!m.ok)throw new Error("Error actualizando usuario");return m.json()}).then(()=>{alert("Usuario actualizado correctamente"),e.classList.add("hidden"),e.classList.remove("flex"),p()}).catch(m=>{console.error("Error actualizando usuario:",m),alert("No se pudo actualizar el usuario.")})})},f=()=>{const e=document.getElementById("openAddUserModal"),t=document.getElementById("addUserModal"),o=document.querySelectorAll(".close-add-user-modal"),n=document.getElementById("addUserForm"),r=document.getElementById("add-puesto");!e||!t||!n||!r||(e.addEventListener("click",()=>{E("add-puesto"),t.classList.remove("hidden"),t.classList.add("flex")}),o.forEach(l=>{l.addEventListener("click",()=>{t.classList.add("hidden"),t.classList.remove("flex"),n.reset()})}),n.addEventListener("submit",l=>{l.preventDefault();const u={name:document.getElementById("add-name").value,email:document.getElementById("add-email").value,num_empleado:document.getElementById("add-num_empleado").value,password:document.getElementById("add-password").value,puesto:document.getElementById("add-puesto").value};fetch(window.USERS_ROUTE,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i(),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(u)}).then(c=>{if(!c.ok)throw new Error("Error al agregar usuario");return c.json()}).then(()=>{alert("Usuario agregado correctamente"),t.classList.add("hidden"),t.classList.remove("flex"),n.reset(),p()}).catch(c=>{console.error("Error agregando usuario:",c),alert("No se pudo agregar el usuario.")})}))};document.addEventListener("DOMContentLoaded",()=>{var e,t;window.USERS_ROUTE||(window.USERS_ROUTE=((t=(e=document.getElementById("users-table-body"))==null?void 0:e.dataset)==null?void 0:t.usersRoute)||"/admin-control/users"),p(),g(),y(),f()})})();
